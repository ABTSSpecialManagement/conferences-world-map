<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Mapbox Groups & Subgroups</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet">
  <style>
    body { margin:0; padding:0; }
    #map { position:absolute; top:0; bottom:0; width:100%; }
    #menu {
      position:absolute;
      background:white;
      padding:10px;
      font-family:sans-serif;
      z-index:1;
    }
    .subcategory { margin-left:15px; }
  </style>
</head>
<body>
  <div id="menu">
    <label><input type="checkbox" value="Medical" checked> Medical Conferences</label><br>
    <div class="subcategory">
      <label><input type="checkbox" value="Oncology" checked> Oncology</label><br>
      <label><input type="checkbox" value="Cardiology" checked> Cardiology</label>
    </div>
    <label><input type="checkbox" value="Tech" checked> Tech Conferences</label><br>
    <div class="subcategory">
      <label><input type="checkbox" value="AI" checked> AI</label><br>
      <label><input type="checkbox" value="Robotics" checked> Robotics</label>
    </div>
  </div>
  <div id="map"></div>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoibWFqYS1wYXZsaWNpYyIsImEiOiJjbWVpYnloeWowMG5xMmtzOGdnN2tjempnIn0.2LRD1_4AAyAVQWZ9kTZa2A';
    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v12',
      center: [-95, 40],
      zoom: 3
    });

    const data = {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "properties": { "category": "Medical", "subcategory": "Oncology", "title": "Oncology Summit" },
          "geometry": { "type": "Point", "coordinates": [-77.0369, 38.9072] } // DC
        },
        {
          "type": "Feature",
          "properties": { "category": "Medical", "subcategory": "Cardiology", "title": "Heart Health Conf" },
          "geometry": { "type": "Point", "coordinates": [-87.6298, 41.8781] } // Chicago
        },
        {
          "type": "Feature",
          "properties": { "category": "Tech", "subcategory": "AI", "title": "AI Expo" },
          "geometry": { "type": "Point", "coordinates": [-122.4194, 37.7749] } // SF
        },
        {
          "type": "Feature",
          "properties": { "category": "Tech", "subcategory": "Robotics", "title": "Robotics World" },
          "geometry": { "type": "Point", "coordinates": [-74.0060, 40.7128] } // NYC
        }
      ]
    };

    map.on('load', () => {
      // Add data source
      map.addSource('conferences', { type: 'geojson', data });

      // Add a layer for all points
      map.addLayer({
        id: 'conferences-layer',
        type: 'circle',
        source: 'conferences',
        paint: {
          'circle-radius': 8,
          'circle-color': [
            'match',
            ['get', 'category'],
            'Medical', '#d73027',
            'Tech', '#4575b4',
            '#cccccc'
          ]
        }
      });

      // Add popups
      map.on('click', 'conferences-layer', (e) => {
        const props = e.features[0].properties;
        new mapboxgl.Popup()
          .setLngLat(e.lngLat)
          .setHTML(`<b>${props.title}</b><br>${props.category} â†’ ${props.subcategory}`)
          .addTo(map);
      });
    });

    // Filtering logic
    const menu = document.getElementById('menu');
    menu.addEventListener('change', () => {
      const checked = Array.from(menu.querySelectorAll('input:checked')).map(i => i.value);

      map.setFilter('conferences-layer', [
        'any',
        ['in', ['get', 'category'], ['literal', checked]],
        ['in', ['get', 'subcategory'], ['literal', checked]]
      ]);
    });
  </script>
</body>
</html>
